

````md

\# Codex conflict prompt（コンフリクト解消用プロンプト）



このドキュメントは、Codex（または同等のコード生成AI）に \*\*Gitのマージコンフリクト解消\*\*をやらせるための「コピペ用プロンプト集」です。  

目的はシンプル：\*\*コンフリクトを安全に解消し、差分を最小にし、ビルドが通る状態に戻す\*\*。



---



\## 0) 前提（この通りにやると事故が減る）

\- AIに渡すのは \*\*コンフリクトマーカー入りの“現物ファイル全文”\*\*  

&nbsp; （`<<<<<<<`, `=======`, `>>>>>>>` が入った状態）

\- まず `git status` の出力で \*\*対象ファイル一覧\*\*を確定する

\- AIの出力は \*\*「解消後のファイル全文」\*\*（差分だけ禁止）にする  

&nbsp; → そのまま置き換えできる

\- AIに勝手な整形をさせない（差分が増えて地獄を見る）



---



\## 1) 事前に人間が用意するもの（入力）

\### A. `git status` の出力

```bash

git status

````



\### B. コンフリクトしているファイル（マーカー付き全文）



該当ファイルを開いて全文コピペ。



\### C. 期待する挙動（分かる範囲でOK）



\* 例：`npm run dev` で起動すること

\* 例：この画面のボタンが動くこと

\* 例：APIの型エラーが消えること



---



\## 2) まずこれ：全体司令官プロンプト（複数ファイル対応）



> 複数ファイルのコンフリクトがあるときの“指揮官”用。

> 先に `git status` とファイルを貼る。



\*\*PROMPT\*\*



```text

あなたは「Gitマージコンフリクト解消専門エンジニア」です。

以下の制約で、提示されたコンフリクトを解消してください。



【目的】

\- コンフリクトマーカー（<<<<<<< ======= >>>>>>>）を完全に除去し、ビルドが通る状態にする

\- 既存の機能を壊さず、両ブランチの意図を可能な限り統合する

\- 変更を最小限にし、不要なリフォーマットや改行の総入れ替えをしない



【優先順位】

1\) 既存機能が壊れないこと（動作の維持）

2\) 型エラー/ESLint/ビルドエラーを出さないこと

3\) コードスタイルは既存に合わせる（勝手に全体整形しない）



【作業手順（あなたが守る）】

\- 各コンフリクトブロックごとに、両側の意図を1行で説明

\- 最終的に採用する形を決め、理由を短く書く

\- 解消後の「完成ファイル全文」を返す（差分ではなく、ファイル全文）

\- 注意点や、残り得るバグ/確認すべき点を最後に箇条書き



【入力として渡すもの】

\- git status の出力

\- コンフリクトしているファイルの内容（マーカー付き）

\- 期待する動作（もし分かれば）



まずは git status を読んで、解消対象のファイル一覧を整理してから、ファイルごとに順番に解消して。

```



---



\## 3) 実務で一番使う：単体ファイル解消プロンプト



> 1ファイルずつ確実に潰す。迷いが減って事故が減る。



\*\*PROMPT\*\*



```text

次のファイルのGitコンフリクトを解消して、コンフリクトマーカーを除去してください。



【方針】

\- 機能優先で統合（片方を丸ごと捨てない）

\- 既存の命名/構造をできるだけ維持

\- 不要な全体整形は禁止（差分を小さく）

\- importの重複・未使用が出ないように整理

\- React/TSなら型とhooksの整合性を崩さない



【出力】

\- 解消後のファイル全文を返す（このファイルだけ）

\- 「どのブロックをどう統合したか」を最後に3～8行で説明



---ここからファイル内容---

（ここにコンフリクトマーカー付き全文を貼る）

---ここまで---

```



---



\## 4) 方針が決まってる時の“即決”追加文（迷いを削る）



\### A) main（またはdevelop）を優先して、とにかく通す



```text

解消方針：main側を優先。ただしfeature側の“機能追加”に見える部分は可能なら取り込む。

ビルドが通ることを最優先し、挙動が変わる場合はその箇所を指摘して。

```



\### B) featureを優先して、新機能中心に統合



```text

解消方針：feature側を優先。ただしmain側の“バグ修正/型修正/設定修正”は落とさない。

特に設定ファイル（package.json, vite.config, tsconfig等）は慎重に統合して。

```



\### C) 生成物なら捨てる（統合しない）



```text

このファイルは生成物の可能性がある。

生成物/ビルド成果物/ログ等なら、手で統合せず削除して再生成が適切か判断して。

必要なら「このファイルは再生成が適切」と明言し、再生成手順を出して。

```



---



\## 5) “コンフリクトを起こしにくくする” Codex開発ルール（最重要）



> コンフリクト解消より、そもそも起こさない方が100倍ラク。



\*\*PROMPT\*\*



```text

今からあなたは「既存コードへの最小差分での追加」だけを行う。絶対に守れ：



\- 既存ファイルを全面書き換えしない（必要な関数/行だけ変更）

\- 既存の並び順、命名、空行を極力維持

\- 変更は小さく分割して提案（1コミット相当の粒度）

\- 変更前後で、どのファイルのどの位置をどう変えるか明示

\- 可能なら新規ファイル追加で済ませ、既存ファイルの変更を減らす

\- 「ついでに整形」「ついでにリファクタ」は禁止



出力は、(1) 変更対象ファイル一覧、(2) 変更内容、(3) パッチ形式（diff）で返す。

```



---



\## 6) 運用の型（これだけでかなり平和になる）



1\. 変更はブランチでやる



&nbsp;  ```bash

&nbsp;  git checkout -b codex-work

&nbsp;  ```

2\. 小さい単位でコミットする（デカいコミットは戦争）

3\. コンフリクトしたら `git status` → \*\*単体ファイルプロンプト\*\*で1個ずつ潰す

4\. 解消したら必ず最小チェック



&nbsp;  ```bash

&nbsp;  npm test   # あれば

&nbsp;  npm run build

&nbsp;  npm run dev

&nbsp;  ```

5\. mainへはPRで戻す（可能ならブランチ保護）



---



\## 7) ありがちな地雷メモ



\* `package-lock.json` / `pnpm-lock.yaml` はコンフリクトしやすい

&nbsp; → 原則「片方採用」して `npm install` で再生成のほうが早いことが多い

\* 全体整形（Prettier等）をAIが勝手に入れると差分が爆発する

&nbsp; → \*\*禁止\*\*を明文化する

\* 「同じファイルをCodexが毎回全文出力」するのが根本原因

&nbsp; → diff出力要求、変更範囲指定、1コミット粒度で抑える



---



```



---



\## 置き場所（runbooksリポジトリ内で）

このファイルは \*\*`prompts/codex-conflict.md`\*\* なので、runbooks内でこういう構造が理想：



```



runbooks/

README.md

prompts/

codex-conflict.md



````



作ってコミットするコマンド（runbooksリポジトリ直下で）：



```powershell

mkdir prompts

notepad prompts\\codex-conflict.md

git add prompts\\codex-conflict.md

git commit -m "Add Codex conflict prompts"

git push

````



これで「次に燃えた時の消火器」がGitHubに常備される。文明だね。



